/* Copyright 2011 Google Inc. All Rights Reserved. */ (function(){var e,k=function(a){return a.replace(/^\s+|\s+$/g,"")},s=function(a){if(a&&a.tagName){var b=a.tagName.toLowerCase();if("input"===b||"textarea"===b)return!0}if(document.designMode&&"on"===document.designMode.toLowerCase())return!0;for(;a;a=a.parentNode)if(a.isContentEditable)return!0;return!1},t=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.onload=function(){var a=null;200===this.status&&(a=c.response);return b(a)};c.send()},u=/[0-9A-Za-z]/,x=function(){t(chrome.runtime.getURL("content.min.css"),
function(a){var b=function(b){this.v=b.instanceId;this.B=a;b=document.createElement("div");var f=document.createElement("a");f.target="_blank";this.t=b.cloneNode(!1);this.p=document.createElement("audio");this.p.I=!0;this.b=b.cloneNode(!1);this.b.id="gdx-bubble-host";this.s=this.b.createShadowRoot?this.b.createShadowRoot():this.b.webkitCreateShadowRoot();var d=document.createElement("style");d.innerHTML=this.B;this.s.appendChild(d);this.a=b.cloneNode(!1);this.a.id="gdx-bubble-main";this.s.appendChild(this.a);
this.e=b.cloneNode(!1);this.e.id="gdx-bubble-query-row";this.q=b.cloneNode(!1);this.q.id="gdx-bubble-query";this.g=b.cloneNode(!1);this.g.id="gdx-bubble-audio-icon";this.e.appendChild(this.q);this.e.appendChild(this.g);this.h=b.cloneNode(!1);this.h.id="gdx-bubble-meaning";this.c=b.cloneNode(!1);this.c.id="gdx-bubble-options-tip";this.c.innerHTML='Tip: Didn\'t want this definition pop-up? Try setting a trigger key in <a href="#">Extension Options</a>.';this.i=b.cloneNode(!1);this.i.id="gdx-bubble-more";
this.f=f.cloneNode(!1);this.i.appendChild(this.f);this.d=b.cloneNode(!1);this.d.id="gdx-bubble-attribution";this.l=f.cloneNode(!1);this.n=b.cloneNode(!1);this.d.appendChild(this.l);this.d.appendChild(this.n);this.o=b.cloneNode(!1);this.o.id="gdx-bubble-close";this.a.appendChild(this.o);this.a.appendChild(this.e);this.a.appendChild(this.h);this.a.appendChild(this.c);this.a.appendChild(this.d);this.a.appendChild(this.i);this.r=b.cloneNode(!1);this.s.appendChild(this.r);this.A=v(b,"up");this.w=v(b,"down");
w(this)}.bind(this);chrome.runtime.sendMessage({type:"initialize"},b)}.bind(this))},y=[];e=x.prototype;e.B="";e.m=0;e.t=null;e.p=null;e.b=null;e.s=null;e.a=null;e.e=null;e.q=null;e.g=null;e.h=null;e.c=null;e.o=null;e.i=null;e.f=null;e.d=null;e.l=null;e.n=null;e.r=null;e.A=null;e.w=null;e.k=null;e.u=null;
var w=function(a){a.u=a.F.bind(a);window.addEventListener("resize",a.j.bind(a));document.addEventListener("mouseup",a.H.bind(a));document.addEventListener("dblclick",a.D.bind(a));document.addEventListener("keydown",a.G.bind(a));a.o.onclick=a.j.bind(a);a.g.onclick=function(){this.p.play()}.bind(a);a.c.querySelector("a").onclick=function(){chrome.runtime.sendMessage({type:"openOptionsPage"},function(){});return!1};var b=function(a){a.preventDefault();a.stopPropagation()};a.g.onmousedown=b;a.o.onmousedown=
b;chrome.runtime.onMessage.addListener(C);chrome.runtime.onMessage.addListener(a.u)},v=function(a,b){var c=a.cloneNode(!1),f=a.cloneNode(!1),d=a.cloneNode(!1);c.id="gdx-arrow-main";"up"===b?(f.id="gdx-bubble-arrow-inner-up",d.id="gdx-bubble-arrow-outer-up"):(f.id="gdx-bubble-arrow-inner-down",d.id="gdx-bubble-arrow-outer-down");c.appendChild(f);c.appendChild(d);return c},D=function(a,b,c,f){this.top=a;this.right=b;this.bottom=c;this.left=f},E=function(a){a.a.style.left="0";a.a.style.top="0";var b=
a.a.offsetWidth,c=a.a.offsetHeight,f=[window.pageXOffset,window.pageYOffset],d=f[0],g=[a.k.left+d,a.k.top+f[1]],n=a.k.bottom-a.k.top,z=g[0]+(a.k.right-a.k.left)/2,f=d+document.documentElement.offsetWidth,l=z-b/2;l+b>f&&(l=f-b);l<d&&(l=d);var r=g[1]-c-12+1,m=g[1]+n+12-1;i:if(b=new D(r,l+b,r+c,l),b.top<window.pageYOffset)b=!1;else{for(var c=document.getElementsByTagName("embed"),A=document.getElementsByTagName("object"),p=[window.pageXOffset,window.pageYOffset],B=p[0],p=p[1],q=0,K=c.length+A.length;q<
K;q++){var h=(q<c.length?c[q]:A[q-c.length]).getBoundingClientRect(),h=new D(h.top+p,h.right+B,h.bottom+p,h.left+B);if(b.bottom>h.top&&h.bottom>b.top&&b.left<h.right&&h.left<b.right){b=!1;break i}}b=!0}b?(m=a.w,m.style.top=g[1]-12+"px"):(r=m,m=a.A,m.style.top=g[1]+n+"px");g=z-12;m.style.left=g+"px";g-5>d&&g+24+5<f&&a.r.appendChild(m);a.a.style.top=r+"px";a.a.style.left=l+"px"};
x.prototype.C=function(a){if(a.eventKey===this.m){this.j();this.g.className="display-none";this.c.className="display-none";this.i.className="";this.d.className="display-none";if(a.meaningObj){var b=a.meaningObj;this.e.className="";this.q.innerHTML=b.prettyQuery;this.h.innerHTML=b.meaningText;b.audio&&(this.p.src=b.audio,this.g.className="");this.f.href=b.moreUrl;this.f.innerHTML="More &raquo;";b.attribution&&("translation"===b.type?(this.n.innerHTML=b.attribution,this.l.className="display-none",this.n.className=
""):(this.t.innerHTML=b.attribution,b=this.t.getElementsByTagName("a")[0],this.l.href=b.href,this.l.innerHTML=b.innerHTML.replace("http://",""),this.l.className="",this.n.className="display-none"),this.d.className="")}else this.e.className="display-none",this.h.innerHTML="No definition found.",this.f.href="http://www.google.com/search?q="+encodeURIComponent(a.sanitizedQuery),this.f.innerHTML='Search the web for "'+a.sanitizedQuery+'" \u00bb';a.showOptionsTip&&(this.c.className="");document.documentElement.appendChild(this.b);
E(this)}};var F=function(a,b){b===a.m&&(a.h.innerHTML="Dictionary is disabled for https pages.",a.f.href="http://support.google.com/TODO",a.f.innerHTML="More information \u00bb",a.i.className="",a.e.className="display-none",a.c.className="display-none",a.d.className="display-none",document.documentElement.appendChild(a.b),E(a))},G=function(a,b){var c=b.getBoundingClientRect();a.k=new D(c.top,c.right,c.bottom,c.left)};
x.prototype.j=function(){this.m++;var a=this.b;a&&a.parentNode&&a.parentNode.removeChild(a);for(a=this.r;a&&a.hasChildNodes();)a.removeChild(a.childNodes[0])};x.prototype.G=function(a){27===a.keyCode&&this.j()};
var H=function(a,b){return"none"===b||"alt"===b&&a.altKey||"ctrl"===b&&(-1!==window.navigator.platform.toLowerCase().indexOf("mac")?a.metaKey:a.ctrlKey)||"shift"===b&&a.shiftKey},I=function(a,b){for(var c=b.target;c;c=c.parentNode)if(c===a.b)return!0;return!1},J=function(a,b,c,f){var d;"mouseup"===c?d="true"===f.popupSelect&&H(b,f.popupSelectKey):"dblclick"===c?d="true"===f.popupSelect&&H(b,f.popupSelectKey)?!1:"true"===f.popupDblclick&&H(b,f.popupDblclickKey):(console.warn("Unexpected eventType: "+
c),d=!1);if(d){d=0;for(var g=y.length;d<g;d++)if(location.href.match(y[d]))return;if(!s(b.target)){d=null;g="";if(window.getSelection){g=window.getSelection();if(1>g.rangeCount)return;d=g.getRangeAt(0);g=k(g.toString())}else document.selection&&(d=document.selection.createRange(),g=k(d.text));if(!(!g||1===g.length&&127>=g.charCodeAt(0)&&!g.match(u)||"dblclick"===c&&-1!==g.indexOf(" "))){a.m++;var n=a.m;I(a,b)||G(a,d);"false"===f.enableHttps&&0===location.href.lastIndexOf("https",0)?F(a,n):(window.setTimeout(function(){n===
this.m&&(this.h.innerHTML="Searching...",this.e.className="display-none",this.c.className="display-none",this.i.className="display-none",this.d.className="display-none",document.documentElement.appendChild(this.b),E(this))}.bind(a),300),chrome.runtime.sendMessage({type:"fetch_raw",eventKey:n,instanceId:a.v,query:g},a.C.bind(a)))}}}};x.prototype.H=function(a){I(this,a)||this.j();var b=function(b){J(this,a,"mouseup",b.options)}.bind(this);chrome.runtime.sendMessage({type:"options"},b)};
x.prototype.D=function(a){var b=function(b){J(this,a,"dblclick",b.options)}.bind(this);chrome.runtime.sendMessage({type:"options"},b)};var C=function(a,b,c){"get_selection"===a.type&&(a=k(window.getSelection().toString()))&&c({selection:a})};x.prototype.F=function(a){"hide"===a.type&&a.instanceId===this.v&&this.j()};var L=L||!1;
if(!L){if(window.gdxBubbleInstance){var M=window.gdxBubbleInstance;chrome.runtime.onMessage.removeListener(C);chrome.runtime.onMessage.removeListener(M.u);M.j()}window.gdxBubbleInstance=new x};})();
